"use strict";

var dataUrl = "https://raw.githubusercontent.com/freeCodeCamp/ProjectReferenceData/master/global-temperature.json";
document.addEventListener("DOMContentLoaded", function () {
  var req = new XMLHttpRequest();
  req.open('GET', dataUrl, true);

  req.onreadystatechange = function () {
    var json;

    if (req.readyState === 4 && req.status === 200) {
      json = JSON.parse(req.responseText);
      setData(json);
    }
  };

  req.send();
});
var gradient = ["#313695", "#4575b4", "#74add1", "#abd9e9", "#e0f3f8", "#ffffbf", "#fee090", "#fdae61", "#f46d43", "#d73027", "#a50026"];
var months = ["january", "february", "march", "april", "may", "june", "july", "august", "september", "october", "november", "december"];
var h = 600,
    w = 1500,
    padding = 100;
d3.select('#holder').append('svg').attr('width', w).attr('height', h);
/**
 * Api object from FCC
 * @typedef {Object} ApiModel
 * @property {Number} year     - Year of the measurement
 * @property {Number} month    - Month of the measurement
 * @property {Number} variance - Variance of temperature with base year
 */

/**
 *
 * @param {Number} baseTemp
 * @param {[ApiModel]} dataset
 */

function setData(_ref) {
  var baseTemp = _ref.baseTemperature,
      dataset = _ref.monthlyVariance;

  /**
   *
   * @param {ApiModel} x
   * @return {Date}
   */
  var getDate = function getDate(x) {
    return new Date(x.year, x.month - 1, 1);
  };
  /**
   *
   * @param {ApiModel} x
   * @return {Number}
   */


  var getVariance = function getVariance(x) {
    return temperature(x.variance);
  };
  /**
   *
   * @param {Number} x
   * @return {Number}
   */


  var temperature = function temperature(x) {
    return baseTemp + x;
  };

  var xDomain = [d3.min(dataset, getDate), d3.max(dataset, getDate)];
  var yDomain = [d3.min(dataset, getVariance), d3.max(dataset, getVariance)];
  console.log(yDomain);
  var xScale = d3.scaleTime().domain(xDomain).range([padding, w - padding]);
  var yScale = d3.scaleLinear().domain([0.5, 12.5]).range([padding, h - padding]);
  var colorScale = d3.scaleQuantile().domain(yDomain).range(gradient);
  var xAxis = d3.axisBottom(xScale).tickSizeOuter(0).tickArguments([d3.timeYear.every(10)]),
      yAxis = d3.axisLeft(yScale).tickSizeOuter(0) //.ticks(12)
  .tickFormat(function (val, index) {
    return months[index];
  });
  var cellHeight = (h - 2 * padding) / months.length;
  var cellOffset = cellHeight / 2;
  d3.select('svg').call(function (svg) {
    svg.append('g').attr("id", "legend").attr('transform', "translate(".concat(padding, ",").concat(h - padding / 2, ")")).call(function (g) {
      var width = 400;
      var height = 30;
      var min = yDomain[0];
      var max = yDomain[1];
      var step = (max - min) / gradient.length;
      var range = d3.range(min, max, step);
      console.log(range);
      var legendScale = d3.scaleLinear().domain(yDomain).range([0, width]);
      var axis = d3.axisBottom(legendScale).tickSizeOuter(0).tickFormat(d3.format(".1f")).tickValues(range);
      g.selectAll('rect').data(range).enter().append('rect').style('fill', function (d) {
        return colorScale(d);
      }).attr('width', width / gradient.length).attr('height', height).attr('x', function (x) {
        return legendScale(x);
      }).attr('y', 0);
      g.append('g').attr("transform", "translate(0,".concat(height, ")")).call(axis);
    });
    svg.selectAll('rect').data(dataset).enter().append('rect').attr('data-month', function (d) {
      return d.month - 1;
    }).attr('data-temp', function (d) {
      return d.variance;
    }).attr('data-year', function (d) {
      return d.year;
    }).attr('class', "cell").style('fill', function (d) {
      return colorScale(temperature(d.variance));
    }).attr('width', 5).attr('height', cellHeight).attr('x', function (d) {
      return xScale(new Date(d.year, 0, 1));
    }).attr('y', function (d) {
      return yScale(d.month) - cellOffset;
    });
    svg.append("g").attr('id', 'x-axis').attr("transform", "translate(0,".concat(h - padding, ")")).call(xAxis);
    svg.append("g").attr('id', 'y-axis').attr("transform", "translate(".concat(padding, ",0)")).call(yAxis);
    svg.append("text").attr("class", "axisLabel").text('Years').style("text-anchor", "middle").attr("x", (w - padding) / 2).attr("y", h - padding + 40);
    svg.append("text").attr("class", "axisLabel").text('Months').style("text-anchor", "middle").attr("transform", "rotate(-90)").attr("x", -h / 2).attr("y", 40);
  }); // const data = {tooltip: d3.select('#tooltip'), xScale, yScale};
  //
  // .on('mouseover', wrap(handleMouseOver, data))
  // .on('mouseout', wrap(handleMouseOut, data));
}
/**
 *
 * @param {ApiModel} d
 */


function handleMouseOver(args, d) {
  var dot = d3.select(this);
  var tooltip = args.tooltip;
  var _d3$event = d3.event,
      x = _d3$event.pageX,
      y = _d3$event.pageY;
  tooltip.style("display", "block");
  tooltip.style("left", x + 20 + "px");
  tooltip.html(toolTipHtml(d));
  var height = tooltip.node().getBoundingClientRect().height;
  tooltip.style("top", y - parseInt(height / 2) + "px");
  tooltip.attr('data-year', d.Year);
  dot.transition().duration(100).attr('r', 10);
}

function handleMouseOut(args) {
  var tooltip = args.tooltip;
  tooltip.style("display", "none");
  var dot = d3.select(this);
  dot.transition().duration(100).attr('r', 8);
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNjcmlwdC5qcyJdLCJuYW1lcyI6WyJkYXRhVXJsIiwiZG9jdW1lbnQiLCJhZGRFdmVudExpc3RlbmVyIiwicmVxIiwiWE1MSHR0cFJlcXVlc3QiLCJvcGVuIiwib25yZWFkeXN0YXRlY2hhbmdlIiwianNvbiIsInJlYWR5U3RhdGUiLCJzdGF0dXMiLCJKU09OIiwicGFyc2UiLCJyZXNwb25zZVRleHQiLCJzZXREYXRhIiwic2VuZCIsImdyYWRpZW50IiwibW9udGhzIiwiaCIsInciLCJwYWRkaW5nIiwiZDMiLCJzZWxlY3QiLCJhcHBlbmQiLCJhdHRyIiwiYmFzZVRlbXAiLCJiYXNlVGVtcGVyYXR1cmUiLCJkYXRhc2V0IiwibW9udGhseVZhcmlhbmNlIiwiZ2V0RGF0ZSIsIngiLCJEYXRlIiwieWVhciIsIm1vbnRoIiwiZ2V0VmFyaWFuY2UiLCJ0ZW1wZXJhdHVyZSIsInZhcmlhbmNlIiwieERvbWFpbiIsIm1pbiIsIm1heCIsInlEb21haW4iLCJjb25zb2xlIiwibG9nIiwieFNjYWxlIiwic2NhbGVUaW1lIiwiZG9tYWluIiwicmFuZ2UiLCJ5U2NhbGUiLCJzY2FsZUxpbmVhciIsImNvbG9yU2NhbGUiLCJzY2FsZVF1YW50aWxlIiwieEF4aXMiLCJheGlzQm90dG9tIiwidGlja1NpemVPdXRlciIsInRpY2tBcmd1bWVudHMiLCJ0aW1lWWVhciIsImV2ZXJ5IiwieUF4aXMiLCJheGlzTGVmdCIsInRpY2tGb3JtYXQiLCJ2YWwiLCJpbmRleCIsImNlbGxIZWlnaHQiLCJsZW5ndGgiLCJjZWxsT2Zmc2V0IiwiY2FsbCIsInN2ZyIsImciLCJ3aWR0aCIsImhlaWdodCIsInN0ZXAiLCJsZWdlbmRTY2FsZSIsImF4aXMiLCJmb3JtYXQiLCJ0aWNrVmFsdWVzIiwic2VsZWN0QWxsIiwiZGF0YSIsImVudGVyIiwic3R5bGUiLCJkIiwidGV4dCIsImhhbmRsZU1vdXNlT3ZlciIsImFyZ3MiLCJkb3QiLCJ0b29sdGlwIiwiZXZlbnQiLCJwYWdlWCIsInkiLCJwYWdlWSIsImh0bWwiLCJ0b29sVGlwSHRtbCIsIm5vZGUiLCJnZXRCb3VuZGluZ0NsaWVudFJlY3QiLCJwYXJzZUludCIsIlllYXIiLCJ0cmFuc2l0aW9uIiwiZHVyYXRpb24iLCJoYW5kbGVNb3VzZU91dCJdLCJtYXBwaW5ncyI6Ijs7QUFFQSxJQUFNQSxPQUFPLEdBQUcsb0dBQWhCO0FBQ0FDLFFBQVEsQ0FBQ0MsZ0JBQVQsQ0FBMEIsa0JBQTFCLEVBQThDLFlBQVk7QUFDdEQsTUFBTUMsR0FBRyxHQUFHLElBQUlDLGNBQUosRUFBWjtBQUNBRCxFQUFBQSxHQUFHLENBQUNFLElBQUosQ0FBUyxLQUFULEVBQWdCTCxPQUFoQixFQUF5QixJQUF6Qjs7QUFDQUcsRUFBQUEsR0FBRyxDQUFDRyxrQkFBSixHQUF5QixZQUFZO0FBQ2pDLFFBQUlDLElBQUo7O0FBQ0EsUUFBSUosR0FBRyxDQUFDSyxVQUFKLEtBQW1CLENBQW5CLElBQXdCTCxHQUFHLENBQUNNLE1BQUosS0FBZSxHQUEzQyxFQUFnRDtBQUM1Q0YsTUFBQUEsSUFBSSxHQUFHRyxJQUFJLENBQUNDLEtBQUwsQ0FBV1IsR0FBRyxDQUFDUyxZQUFmLENBQVA7QUFDQUMsTUFBQUEsT0FBTyxDQUFDTixJQUFELENBQVA7QUFDSDtBQUNKLEdBTkQ7O0FBT0FKLEVBQUFBLEdBQUcsQ0FBQ1csSUFBSjtBQUNILENBWEQ7QUFhQSxJQUFNQyxRQUFRLEdBQUcsQ0FBQyxTQUFELEVBQVksU0FBWixFQUF1QixTQUF2QixFQUFrQyxTQUFsQyxFQUE2QyxTQUE3QyxFQUF3RCxTQUF4RCxFQUFtRSxTQUFuRSxFQUE4RSxTQUE5RSxFQUF5RixTQUF6RixFQUFvRyxTQUFwRyxFQUErRyxTQUEvRyxDQUFqQjtBQUNBLElBQU1DLE1BQU0sR0FBRyxDQUFDLFNBQUQsRUFBWSxVQUFaLEVBQXdCLE9BQXhCLEVBQWlDLE9BQWpDLEVBQTBDLEtBQTFDLEVBQWlELE1BQWpELEVBQXlELE1BQXpELEVBQWlFLFFBQWpFLEVBQTJFLFdBQTNFLEVBQXdGLFNBQXhGLEVBQW1HLFVBQW5H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R0FBaUJDLFFBQWpCLENBQTBCLEdBQTFCLEVBQStCeEUsSUFBL0IsQ0FBb0MsR0FBcEMsRUFBeUMsRUFBekM7QUFFSDs7QUFFRCxTQUFTeUUsY0FBVCxDQUF3QmYsSUFBeEIsRUFBOEI7QUFBQSxNQUNuQkUsT0FEbUIsR0FDUkYsSUFEUSxDQUNuQkUsT0FEbUI7QUFFMUJBLEVBQUFBLE9BQU8sQ0FBQ04sS0FBUixDQUFjLFNBQWQsRUFBeUIsTUFBekI7QUFFQSxNQUFNSyxHQUFHLEdBQUc5RCxFQUFFLENBQUNDLE1BQUgsQ0FBVSxJQUFWLENBQVo7QUFDQTZELEVBQUFBLEdBQUcsQ0FBQ1ksVUFBSixHQUFpQkMsUUFBakIsQ0FBMEIsR0FBMUIsRUFBK0J4RSxJQUEvQixDQUFvQyxHQUFwQyxFQUF5QyxDQUF6QztBQUVIIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0ICogYXMgZDMgZnJvbSBcIkB0eXBlcy9kM1wiO1xuXG5jb25zdCBkYXRhVXJsID0gXCJodHRwczovL3Jhdy5naXRodWJ1c2VyY29udGVudC5jb20vZnJlZUNvZGVDYW1wL1Byb2plY3RSZWZlcmVuY2VEYXRhL21hc3Rlci9nbG9iYWwtdGVtcGVyYXR1cmUuanNvblwiO1xuZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcIkRPTUNvbnRlbnRMb2FkZWRcIiwgZnVuY3Rpb24gKCkge1xuICAgIGNvbnN0IHJlcSA9IG5ldyBYTUxIdHRwUmVxdWVzdCgpO1xuICAgIHJlcS5vcGVuKCdHRVQnLCBkYXRhVXJsLCB0cnVlKTtcbiAgICByZXEub25yZWFkeXN0YXRlY2hhbmdlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICBsZXQganNvbjtcbiAgICAgICAgaWYgKHJlcS5yZWFkeVN0YXRlID09PSA0ICYmIHJlcS5zdGF0dXMgPT09IDIwMCkge1xuICAgICAgICAgICAganNvbiA9IEpTT04ucGFyc2UocmVxLnJlc3BvbnNlVGV4dCk7XG4gICAgICAgICAgICBzZXREYXRhKGpzb24pXG4gICAgICAgIH1cbiAgICB9O1xuICAgIHJlcS5zZW5kKCk7XG59KTtcblxuY29uc3QgZ3JhZGllbnQgPSBbXCIjMzEzNjk1XCIsIFwiIzQ1NzViNFwiLCBcIiM3NGFkZDFcIiwgXCIjYWJkOWU5XCIsIFwiI2UwZjNmOFwiLCBcIiNmZmZmYmZcIiwgXCIjZmVlMDkwXCIsIFwiI2ZkYWU2MVwiLCBcIiNmNDZkNDNcIiwgXCIjZDczMDI3XCIsIFwiI2E1MDAyNlwiXTtcbmNvbnN0IG1vbnRocyA9IFtcImphbnVhcnlcIiwgXCJmZWJydWFyeVwiLCBcIm1hcmNoXCIsIFwiYXByaWxcIiwgXCJtYXlcIiwgXCJqdW5lXCIsIFwianVseVwiLCBcImF1Z3VzdFwiLCBcInNlcHRlbWJlclwiLCBcIm9jdG9iZXJcIiwgXCJub3ZlbWJlclwiLCBcImRlY2VtYmVyXCJdO1xuXG5jb25zdCBoID0gNjAwLCB3ID0gMTUwMCwgcGFkZGluZyA9IDEwMDtcblxuZDMuc2VsZWN0KCcjaG9sZGVyJylcbiAgICAuYXBwZW5kKCdzdmcnKVxuICAgIC5hdHRyKCd3aWR0aCcsIHcpXG4gICAgLmF0dHIoJ2hlaWdodCcsIGgpO1xuXG4vKipcbiAqIEFwaSBvYmplY3QgZnJvbSBGQ0NcbiAqIEB0eXBlZGVmIHtPYmplY3R9IEFwaU1vZGVsXG4gKiBAcHJvcGVydHkge051bWJlcn0geWVhciAgICAgLSBZZWFyIG9mIHRoZSBtZWFzdXJlbWVudFxuICogQHByb3BlcnR5IHtOdW1iZXJ9IG1vbnRoICAgIC0gTW9udGggb2YgdGhlIG1lYXN1cmVtZW50XG4gKiBAcHJvcGVydHkge051bWJlcn0gdmFyaWFuY2UgLSBWYXJpYW5jZSBvZiB0ZW1wZXJhdHVyZSB3aXRoIGJhc2UgeWVhclxuICovXG5cbi8qKlxuICpcbiAqIEBwYXJhbSB7TnVtYmVyfSBiYXNlVGVtcFxuICogQHBhcmFtIHtbQXBpTW9kZWxdfSBkYXRhc2V0XG4gKi9cbmZ1bmN0aW9uIHNldERhdGEoe2Jhc2VUZW1wZXJhdHVyZTogYmFzZVRlbXAsIG1vbnRobHlWYXJpYW5jZTogZGF0YXNldH0pIHtcbiAgICAvKipcbiAgICAgKlxuICAgICAqIEBwYXJhbSB7QXBpTW9kZWx9IHhcbiAgICAgKiBAcmV0dXJuIHtEYXRlfVxuICAgICAqL1xuICAgIGNvbnN0IGdldERhdGUgPSB4ID0+IG5ldyBEYXRlKHgueWVhciwgeC5tb250aCAtIDEsIDEpO1xuICAgIC8qKlxuICAgICAqXG4gICAgICogQHBhcmFtIHtBcGlNb2RlbH0geFxuICAgICAqIEByZXR1cm4ge051bWJlcn1cbiAgICAgKi9cbiAgICBjb25zdCBnZXRWYXJpYW5jZSA9IHggPT4gdGVtcGVyYXR1cmUoeC52YXJpYW5jZSk7XG5cbiAgICAvKipcbiAgICAgKlxuICAgICAqIEBwYXJhbSB7TnVtYmVyfSB4XG4gICAgICogQHJldHVybiB7TnVtYmVyfVxuICAgICAqL1xuICAgIGNvbnN0IHRlbXBlcmF0dXJlID0geCA9PiBiYXNlVGVtcCArIHg7XG5cblxuICAgIGNvbnN0IHhEb21haW4gPSBbZDMubWluKGRhdGFzZXQsIGdldERhdGUpLCBkMy5tYXgoZGF0YXNldCwgZ2V0RGF0ZSldO1xuXG4gICAgY29uc3QgeURvbWFpbiA9IFtkMy5taW4oZGF0YXNldCwgZ2V0VmFyaWFuY2UpLCBkMy5tYXgoZGF0YXNldCwgZ2V0VmFyaWFuY2UpXTtcbiAgICBjb25zb2xlLmxvZyh5RG9tYWluKTtcblxuICAgIGNvbnN0IHhTY2FsZSA9IGQzLnNjYWxlVGltZSgpXG4gICAgICAgIC5kb21haW4oeERvbWFpbilcbiAgICAgICAgLnJhbmdlKFtwYWRkaW5nLCB3IC0gcGFkZGluZ10pO1xuXG4gICAgY29uc3QgeVNjYWxlID0gZDMuc2NhbGVMaW5lYXIoKVxuICAgICAgICAuZG9tYWluKFswLjUsIDEyLjVdKVxuICAgICAgICAucmFuZ2UoW3BhZGRpbmcsIGggLSBwYWRkaW5nXSk7XG5cbiAgICBjb25zdCBjb2xvclNjYWxlID0gZDMuc2NhbGVRdWFudGlsZSgpXG4gICAgICAgIC5kb21haW4oeURvbWFpbilcbiAgICAgICAgLnJhbmdlKGdyYWRpZW50KTtcblxuXG4gICAgY29uc3QgeEF4aXMgPSBkMy5heGlzQm90dG9tKHhTY2FsZSlcbiAgICAgICAgICAgIC50aWNrU2l6ZU91dGVyKDApXG4gICAgICAgICAgICAudGlja0FyZ3VtZW50cyhbZDMudGltZVllYXIuZXZlcnkoMTApXSksXG5cbiAgICAgICAgeUF4aXMgPSBkMy5heGlzTGVmdCh5U2NhbGUpXG4gICAgICAgICAgICAudGlja1NpemVPdXRlcigwKVxuICAgICAgICAgICAgLy8udGlja3MoMTIpXG4gICAgICAgICAgICAudGlja0Zvcm1hdCgodmFsLCBpbmRleCkgPT4gbW9udGhzW2luZGV4XSk7XG5cblxuICAgIGNvbnN0IGNlbGxIZWlnaHQgPSAoaCAtIDIgKiBwYWRkaW5nKSAvIG1vbnRocy5sZW5ndGg7XG4gICAgY29uc3QgY2VsbE9mZnNldCA9IGNlbGxIZWlnaHQgLyAyO1xuXG5cbiAgICBkMy5zZWxlY3QoJ3N2ZycpLmNhbGwoc3ZnID0+IHtcblxuICAgICAgICBzdmcuYXBwZW5kKCdnJylcbiAgICAgICAgICAgIC5hdHRyKFwiaWRcIiwgXCJsZWdlbmRcIilcbiAgICAgICAgICAgIC5hdHRyKCd0cmFuc2Zvcm0nLCBgdHJhbnNsYXRlKCR7cGFkZGluZ30sJHtoIC0gcGFkZGluZyAvIDJ9KWApXG4gICAgICAgICAgICAuY2FsbCgoZykgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnN0IHdpZHRoID0gNDAwO1xuICAgICAgICAgICAgICAgIGNvbnN0IGhlaWdodCA9IDMwO1xuICAgICAgICAgICAgICAgIGNvbnN0IG1pbiA9IHlEb21haW5bMF07XG4gICAgICAgICAgICAgICAgY29uc3QgbWF4ID0geURvbWFpblsxXTtcbiAgICAgICAgICAgICAgICBjb25zdCBzdGVwID0gKG1heCAtIG1pbikgLyBncmFkaWVudC5sZW5ndGg7XG5cbiAgICAgICAgICAgICAgICBjb25zdCByYW5nZSA9IGQzLnJhbmdlKG1pbiwgbWF4LCBzdGVwKTtcblxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKHJhbmdlKVxuXG4gICAgICAgICAgICAgICAgY29uc3QgbGVnZW5kU2NhbGUgPSBkMy5zY2FsZUxpbmVhcigpXG4gICAgICAgICAgICAgICAgICAgIC5kb21haW4oeURvbWFpbilcbiAgICAgICAgICAgICAgICAgICAgLnJhbmdlKFswLCB3aWR0aF0pO1xuXG4gICAgICAgICAgICAgICAgY29uc3QgYXhpcyA9IGQzLmF4aXNCb3R0b20obGVnZW5kU2NhbGUpXG4gICAgICAgICAgICAgICAgICAgIC50aWNrU2l6ZU91dGVyKDApXG4gICAgICAgICAgICAgICAgICAgIC50aWNrRm9ybWF0KGQzLmZvcm1hdChcIi4xZlwiKSlcbiAgICAgICAgICAgICAgICAgICAgLnRpY2tWYWx1ZXMocmFuZ2UpXG4gICAgICAgICAgICAgICAgO1xuICAgICAgICAgICAgICAgIGcuc2VsZWN0QWxsKCdyZWN0JylcbiAgICAgICAgICAgICAgICAgICAgLmRhdGEocmFuZ2UpXG4gICAgICAgICAgICAgICAgICAgIC5lbnRlcigpXG4gICAgICAgICAgICAgICAgICAgIC5hcHBlbmQoJ3JlY3QnKVxuICAgICAgICAgICAgICAgICAgICAuc3R5bGUoJ2ZpbGwnLCBkID0+IGNvbG9yU2NhbGUoZCkpXG4gICAgICAgICAgICAgICAgICAgIC5hdHRyKCd3aWR0aCcsIHdpZHRoIC8gZ3JhZGllbnQubGVuZ3RoKVxuICAgICAgICAgICAgICAgICAgICAuYXR0cignaGVpZ2h0JywgaGVpZ2h0KVxuICAgICAgICAgICAgICAgICAgICAuYXR0cigneCcsIHggPT4gbGVnZW5kU2NhbGUoeCkpXG4gICAgICAgICAgICAgICAgICAgIC5hdHRyKCd5JywgMClcbiAgICAgICAgICAgICAgICA7XG4gICAgICAgICAgICAgICAgZy5hcHBlbmQoJ2cnKVxuICAgICAgICAgICAgICAgICAgICAuYXR0cihcInRyYW5zZm9ybVwiLCBgdHJhbnNsYXRlKDAsJHtoZWlnaHR9KWApXG4gICAgICAgICAgICAgICAgICAgIC5jYWxsKGF4aXMpXG4gICAgICAgICAgICB9KVxuICAgICAgICA7XG5cbiAgICAgICAgc3ZnLnNlbGVjdEFsbCgncmVjdCcpXG4gICAgICAgICAgICAuZGF0YShkYXRhc2V0KVxuICAgICAgICAgICAgLmVudGVyKClcbiAgICAgICAgICAgIC5hcHBlbmQoJ3JlY3QnKVxuICAgICAgICAgICAgLmF0dHIoJ2RhdGEtbW9udGgnLCBkID0+IGQubW9udGggLSAxKVxuICAgICAgICAgICAgLmF0dHIoJ2RhdGEtdGVtcCcsIGQgPT4gZC52YXJpYW5jZSlcbiAgICAgICAgICAgIC5hdHRyKCdkYXRhLXllYXInLCBkID0+IGQueWVhcilcbiAgICAgICAgICAgIC5hdHRyKCdjbGFzcycsIFwiY2VsbFwiKVxuICAgICAgICAgICAgLnN0eWxlKCdmaWxsJywgZCA9PiBjb2xvclNjYWxlKHRlbXBlcmF0dXJlKGQudmFyaWFuY2UpKSlcbiAgICAgICAgICAgIC5hdHRyKCd3aWR0aCcsIDUpXG4gICAgICAgICAgICAuYXR0cignaGVpZ2h0JywgY2VsbEhlaWdodClcbiAgICAgICAgICAgIC5hdHRyKCd4JywgZCA9PiB4U2NhbGUobmV3IERhdGUoZC55ZWFyLCAwLCAxKSkpXG4gICAgICAgICAgICAuYXR0cigneScsIGQgPT4geVNjYWxlKGQubW9udGgpIC0gY2VsbE9mZnNldClcbiAgICAgICAgO1xuXG4gICAgICAgIHN2Zy5hcHBlbmQoXCJnXCIpXG4gICAgICAgICAgICAuYXR0cignaWQnLCAneC1heGlzJylcbiAgICAgICAgICAgIC5hdHRyKFwidHJhbnNmb3JtXCIsIGB0cmFuc2xhdGUoMCwke2ggLSBwYWRkaW5nfSlgKVxuICAgICAgICAgICAgLmNhbGwoeEF4aXMpO1xuXG4gICAgICAgIHN2Zy5hcHBlbmQoXCJnXCIpXG4gICAgICAgICAgICAuYXR0cignaWQnLCAneS1heGlzJylcbiAgICAgICAgICAgIC5hdHRyKFwidHJhbnNmb3JtXCIsIGB0cmFuc2xhdGUoJHtwYWRkaW5nfSwwKWApXG4gICAgICAgICAgICAuY2FsbCh5QXhpcyk7XG5cbiAgICAgICAgc3ZnLmFwcGVuZChcInRleHRcIilcbiAgICAgICAgICAgIC5hdHRyKFwiY2xhc3NcIiwgXCJheGlzTGFiZWxcIilcbiAgICAgICAgICAgIC50ZXh0KCdZZWFycycpXG4gICAgICAgICAgICAuc3R5bGUoXCJ0ZXh0LWFuY2hvclwiLCBcIm1pZGRsZVwiKVxuICAgICAgICAgICAgLmF0dHIoXCJ4XCIsICh3IC0gcGFkZGluZykgLyAyKVxuICAgICAgICAgICAgLmF0dHIoXCJ5XCIsIGggLSBwYWRkaW5nICsgNDApO1xuXG4gICAgICAgIHN2Zy5hcHBlbmQoXCJ0ZXh0XCIpXG4gICAgICAgICAgICAuYXR0cihcImNsYXNzXCIsIFwiYXhpc0xhYmVsXCIpXG4gICAgICAgICAgICAudGV4dCgnTW9udGhzJylcbiAgICAgICAgICAgIC5zdHlsZShcInRleHQtYW5jaG9yXCIsIFwibWlkZGxlXCIpXG4gICAgICAgICAgICAuYXR0cihcInRyYW5zZm9ybVwiLCBgcm90YXRlKC05MClgKVxuICAgICAgICAgICAgLmF0dHIoXCJ4XCIsIC1oIC8gMilcbiAgICAgICAgICAgIC5hdHRyKFwieVwiLCA0MCk7XG5cblxuICAgIH0pO1xuXG5cbiAgICAvLyBjb25zdCBkYXRhID0ge3Rvb2x0aXA6IGQzLnNlbGVjdCgnI3Rvb2x0aXAnKSwgeFNjYWxlLCB5U2NhbGV9O1xuICAgIC8vXG5cbiAgICAvLyAub24oJ21vdXNlb3ZlcicsIHdyYXAoaGFuZGxlTW91c2VPdmVyLCBkYXRhKSlcbiAgICAvLyAub24oJ21vdXNlb3V0Jywgd3JhcChoYW5kbGVNb3VzZU91dCwgZGF0YSkpO1xufVxuXG5cbi8qKlxuICpcbiAqIEBwYXJhbSB7QXBpTW9kZWx9IGRcbiAqL1xuZnVuY3Rpb24gaGFuZGxlTW91c2VPdmVyKGFyZ3MsIGQpIHtcbiAgICBjb25zdCBkb3QgPSBkMy5zZWxlY3QodGhpcyk7XG4gICAgY29uc3Qge3Rvb2x0aXB9ID0gYXJncztcbiAgICBjb25zdCB7cGFnZVg6IHgsIHBhZ2VZOiB5fSA9IGQzLmV2ZW50O1xuICAgIHRvb2x0aXAuc3R5bGUoXCJkaXNwbGF5XCIsIFwiYmxvY2tcIik7XG4gICAgdG9vbHRpcC5zdHlsZShcImxlZnRcIiwgeCArIDIwICsgXCJweFwiKTtcbiAgICB0b29sdGlwLmh0bWwodG9vbFRpcEh0bWwoZCkpO1xuICAgIGNvbnN0IGhlaWdodCA9IHRvb2x0aXAubm9kZSgpLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLmhlaWdodDtcbiAgICB0b29sdGlwLnN0eWxlKFwidG9wXCIsIHkgLSBwYXJzZUludChoZWlnaHQgLyAyKSArIFwicHhcIik7XG4gICAgdG9vbHRpcC5hdHRyKCdkYXRhLXllYXInLCBkLlllYXIpO1xuXG5cbiAgICBkb3QudHJhbnNpdGlvbigpLmR1cmF0aW9uKDEwMCkuYXR0cigncicsIDEwKTtcblxufVxuXG5mdW5jdGlvbiBoYW5kbGVNb3VzZU91dChhcmdzKSB7XG4gICAgY29uc3Qge3Rvb2x0aXB9ID0gYXJncztcbiAgICB0b29sdGlwLnN0eWxlKFwiZGlzcGxheVwiLCBcIm5vbmVcIik7XG5cbiAgICBjb25zdCBkb3QgPSBkMy5zZWxlY3QodGhpcyk7XG4gICAgZG90LnRyYW5zaXRpb24oKS5kdXJhdGlvbigxMDApLmF0dHIoJ3InLCA4KTtcblxufVxuIl19